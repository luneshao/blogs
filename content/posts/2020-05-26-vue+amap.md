---
title: 'Vue ä¸­å¼‚æ­¥åŠ è½½ AMap'
description: 'vue ä¸­å¼‚æ­¥åŠ è½½ amap çš„ js æ–‡ä»¶'
author: 'luneShao'
categories: ['vue']
tags: ['vue', 'amap', 'å‰ç«¯']
type: "post"
date: 2020-05-26T14:27:32+08:00
draft: false
---

### å‰è¨€

æœ€è¿‘åœ¨ä¼˜åŒ–ä¹‹å‰å†™çš„ç½‘ç«™ï¼ŒFP å¤§æ¦‚è¦åŠåˆ†é’Ÿæ‰èƒ½åŠ è½½å‡ºæ¥ï¼Œemmmï¼Œæˆ‘å†™çš„ã€‚ã€‚ã€‚

è¿™ä¸ªä¹Ÿæ˜¯ä¹‹å‰æ–‡ç« ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºæˆ‘çš„ç½‘é¡µä¸­æœ‰ç”¨åˆ°åœ°å›¾ï¼Œä¹‹å‰ç”¨çš„ `vue-amap` ç»„ä»¶ï¼Œåæ¥è§‰å¾—è¿™ä¸ªå¼•ç”¨ cdn ä¸çŸ¥é“æ€ä¹ˆä¸‹æ‰‹ï¼Œå°±æ”¹æˆäº†ç›´æ¥ç”¨èŠ‚ç‚¹æ¸²æŸ“ï¼Œä¸ç”¨ç»„ä»¶äº†ã€‚ç„¶ååˆæŸ¥äº†å¼‚æ­¥åŠ è½½çš„æ–¹å¼ï¼Œå‘ç°äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯åæœŸåˆå‘ç°äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„ä¸€äº› bugï¼Œä¸€é€šç™¾åº¦åŠ è‡ªå·±å°è¯•ä¿®æ”¹äº†ä¸€ä¸‹ã€‚

## æ­£æ–‡

å…ˆè´´ä¸€ä¸‹[åŸæ–‡](https://www.jianshu.com/p/f65034cf7d24)çš„è§£å†³æ–¹æ¡ˆ:

> #### 1. åˆ›å»ºä¸€ä¸ª AMap.js,è·¯å¾„'src/assets/js/AMap.js'

```js
// src/assets/js/AMap.js

export default function MapLoader() {
  // <-- åŸä½œè€…è¿™é‡Œä½¿ç”¨çš„æ˜¯module.exports
  return new Promise((resolve, reject) => {
    if (window.AMap) {
      resolve(window.AMap)
    } else {
      var script = document.createElement('script')
      script.type = 'text/javascript'
      script.async = true
      script.src =
        'http://webapi.amap.com/maps?v=1.3&callback=initAMap&key=yourkey'
      script.onerror = reject
      document.head.appendChild(script)
    }
    window.initAMap = () => {
      resolve(window.AMap)
    }
  })
}
```

#### 2. åœ¨ä»»ä½•.vue æ–‡ä»¶ä¸­ä½¿ç”¨

```vue
// test.vue
<template>
  <div class="test">
    <div id="container" class="h300 w300"></div>
  </div>
</template>
<script>
import MapLoader from '@/assets/js/AMap.js'
export default {
  name: 'test',
  data() {
    return {
      map: null,
    }
  },
  mounted() {
    let that = this
    MapLoader().then(
      (AMap) => {
        console.log('åœ°å›¾åŠ è½½æˆåŠŸ')
        that.map = new AMap.Map('container', {
          center: [117.000923, 36.675807],
          zoom: 11,
        })
      },
      (e) => {
        console.log('åœ°å›¾åŠ è½½å¤±è´¥', e)
      }
    )
  },
}
</script>
```

## é‡åˆ°çš„é—®é¢˜

1. æˆ‘ copy ä»£ç ä¹‹åï¼Œå›è°ƒå‡½æ•°ä¸­è·å–ä¸åˆ° `AMap`ã€‚
   ä¸æ¸…æ¥š window.init è¿™ä¸ªäº‹ä»¶æˆ–æ˜¯å‡½æ•°æ˜¯ä»€ä¹ˆæ„æ€ã€‚è¿™é‡Œå‚è€ƒ[æ–‡æ¡£ç»™å‡ºçš„å¼‚æ­¥åŠ è½½æ–¹æ¡ˆ](https://lbs.amap.com/api/javascript-api/guide/abc/load)ï¼Œå…¶ä¸­æœ‰ç”¨åˆ° window.init ï¼Œæˆ‘åœ¨ç½‘é¡µä¸­æ‰“å° window å¹¶æ²¡æœ‰ init è¿™ä¸ªå±æ€§ï¼Œè¿™é‡Œæ˜¯ä¸æ˜¯è¿˜éœ€è¦å†è¿›è¡Œè°ƒç”¨ï¼Ÿ
   ç„¶åï¼Œæˆ‘å°±å°† window.init ä¿®æ”¹ä¸º window.onloadï¼Œç­‰ js èµ„æºåŠ è½½å®Œæˆåå†å°† AMap å¯¹è±¡è¿”å›ç»™å›è°ƒå‡½æ•°ã€‚ç„¶åå°±èƒ½è·å–åˆ°äº†ã€‚
   ç­‰æˆ‘åæ¥è°ƒè¯•çš„æ—¶å€™ï¼Œåˆé‡åˆ°äº† bug2 å·ã€‚
2. è‹¥é¦–æ¬¡æ‰“å¼€çš„é¡µé¢ä¸åŒ…å«åŠ è½½äº†åœ°å›¾çš„ç»„ä»¶ï¼Œç»è·¯ç”±è·³è½¬åè¿½åŠ çš„è„šæœ¬ï¼Œå›è°ƒå‡½æ•°ä¹Ÿæ‹¿ä¸åˆ° AMap å¯¹è±¡ã€‚
   å› ä¸º window.onload åªåœ¨é¦–æ¬¡é¡µé¢èµ„æºåŠ è½½å®Œæˆåè°ƒç”¨ã€‚vue åˆ‡æ¢è·¯ç”±åªæ˜¯åˆ‡æ¢äº†èŠ‚ç‚¹ä¸­çš„å†…å®¹ï¼Œå¹¶æœªåˆ·æ–°é¡µé¢ã€‚æ‰€ä»¥è¿½åŠ äº† script æ ‡ç­¾åï¼Œå¹¶ä¸ä¼šå†æ‰§è¡Œ window.onload äº†ï¼Œå°±æ‹¿ä¸åˆ°è„šæœ¬è§£æå AMap å¯¹è±¡äº†ã€‚
   æ°å¥½æˆ‘ä¸Šåˆçœ‹åˆ°äº†ç›¸å…³å†…å®¹å°±åˆåšäº†ä¿®æ”¹ï¼Œå°† window.onload æ›¿æ¢ä¸º script.onload (æ„æ€ä¸ºè„šæœ¬èµ„æºåŠ è½½å®Œæˆ)ï¼Œç›®å‰æš‚æ—¶è§£å†³é—®é¢˜äº†ã€‚ [load](https://developer.mozilla.org/zh-CN/docs/Web/Events/load) çš„æ–‡æ¡£ã€‚

## å‚è€ƒæ–‡çŒ®
ï¼ˆps: ç‚¹å‡»æ–‡çŒ®éƒ½å¯ä»¥ç›´è¾¾æ–‡ç« ï¼‰

- [load MDN](https://developer.mozilla.org/zh-CN/docs/Web/Events/load)

> load äº‹ä»¶: å½“ä¸€ä¸ªèµ„æºåŠå…¶ä¾èµ–èµ„æºå·²å®ŒæˆåŠ è½½æ—¶ï¼Œå°†è§¦å‘ load äº‹ä»¶ã€‚

- [window çš„ onload äº‹ä»¶å’Œ domcontentloaded æ‰§è¡Œé¡ºåº](https://www.oecom.cn/window-onload-domcontentloaded/)

> ```
onload äº‹ä»¶æ”¯æŒ 

æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹éƒ½æœ‰å“ªäº›æ”¯æŒonloadäº‹ä»¶ã€‚
- æ”¯æŒè¯¥äº‹ä»¶çš„ HTML æ ‡ç­¾ï¼š<body>, <frame>, <frameset>, <iframe>, <img>, <link>, <script>;
- æ”¯æŒè¯¥äº‹ä»¶çš„ JavaScript å¯¹è±¡ï¼šimage, layer, window
```

- [JavaScript åˆ¤æ–­å›¾ç‰‡æ˜¯å¦åŠ è½½å®Œæˆçš„ä¸‰ç§æ–¹å¼](https://www.cnblogs.com/snandy/p/3704938.html)

> ```html
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>img - load event</title>
</head>
<body>
    <img id="img1" src="http://pic1.win4000.com/wallpaper/f/51c3bb99a21ea.jpg">
    <p id="p1">loading...</p>
    <script type="text/javascript">
        img1.onload = function() {
            p1.innerHTML = 'loaded'
        }
    </script>
</body>
</html>
```

ä»¥ä¸Šã€‚ğŸ˜†
