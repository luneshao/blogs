+++
title = "Vue 优化"
description = "vue 打包体积优化"
tags = [ "vue", "前端" ]
date = "2020-05-20"
location = "JiNan, CN"
type = "post"
keywords = "vue, antdv"
+++
## 1、字体包压缩
使用 [fontmin](https://github.com/ecomfe/fontmin) 这个库压缩字体包。（字体下载地址 [字体下载网](http://www.font168.com/) ，这个下载的苹方简-常规可以被格式化。）

## 2、图片使用懒加载
使用 [vue-lazyload](https://www.npmjs.com/package/vue-lazyload) 库优化图片加载，滚动到某处再加载图片。

## 3、打包线上版本，使用cdn引入包

```js
// --------------
// .env
// --------------
NODE_ENV === 'production'

// --------------
// vue.config.js
// --------------

const isProd = process.env.NODE_ENV === 'production'

const assetsCDN = {
  // webpack build externals
  externals: {
    vue: 'Vue',
    'vue-router': 'VueRouter',
    'vue-lazyload': 'VueLazyload',
  },
  css: ['//cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css'],
  // https://unpkg.com/browse/vue@2.6.10/
  js: [
    '//cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js',
    '//cdn.jsdelivr.net/npm/vue-router@3.1.6/dist/vue-router.min.js',
    '//cdn.jsdelivr.net/npm/vue-lazyload@1.3.3/vue-lazyload.min.js',
  ]
}

module.exports = {
  configureWebpack: config => {
    if (isProd) {
      return {
        resolve: {
          alias: {
            '@ant-design/icons/lib/dist$': resolve('./src/core/antd/icons.js')
          }
        },
        externals: assetsCDN.externals,
        plugins: [new webpack.IgnorePlugin(/^\.\/locale$/, /moment$/)]
      }
    }
  },

  chainWebpack: config => {
    config.plugin('html').tap(args => {
      args[0].title = process.env.VUE_APP_TITLE
      if (isProd) {
        args[0].cdn = assetsCDN
      }
      return args
    })
  }
}
```

```html
<!-- index.html -->
...
<!-- require cdn assets css -->
  <% for (var i in htmlWebpackPlugin.options.cdn && htmlWebpackPlugin.options.cdn.css) { %>
  <link rel="stylesheet" href="<%= htmlWebpackPlugin.options.cdn.css[i] %>" />
  <% } %>
...
<!-- require cdn assets js -->
  <% for (var i in htmlWebpackPlugin.options.cdn && htmlWebpackPlugin.options.cdn.js) { %>
  <script type="text/javascript" src="<%= htmlWebpackPlugin.options.cdn.js[i] %>"></script>
  <% } %>
```

## 4、ant-design-vue 相关
### 4.1 打包后，icon 包体积过大
参考此 [issue](https://github.com/vueComponent/ant-design-vue/issues/1109) 作者的[回答](https://github.com/vueComponent/ant-design-vue/issues/1109#issuecomment-563094161)

### 4.2 打包后，moment 包体积过大
参考此优化方案 [github](https://github.com/jmblog/how-to-optimize-momentjs-with-webpack)

以上。
